# Workflows

Copinance OS supports multiple types of workflows for stock research.

## Static Workflows

Static workflows follow a predefined analysis pipeline with consistent steps.

### What It Does

1. Fetches stock information
2. Gets current market quote
3. Retrieves historical price data (timeframe-dependent)
4. Gets fundamental data
5. Calculates key metrics and trends
6. Generates analysis summary

### When to Use

- ✅ Consistent, repeatable analysis
- ✅ No API key required
- ✅ Fast execution
- ✅ Comprehensive coverage

### Example

```bash
copinance research run AAPL --workflow stock --timeframe mid_term
```

## Agentic Workflows

Agentic workflows use AI to dynamically analyze stocks based on your questions.

### What It Does

1. Understands your question
2. Selects appropriate tools (data providers)
3. Gathers relevant data
4. Analyzes and synthesizes information
5. Provides tailored answer adapted to your financial literacy level

### When to Use

- ✅ Custom questions and analysis
- ✅ Adaptive to specific needs
- ✅ Natural language interaction
- ✅ Personalized responses based on financial literacy level
- ⚠️ Requires Gemini API key

### Example

```bash
copinance research ask AAPL "What are the key financial risks?"
```

### Setup Required

See [Configuration](configuration) for setting up Gemini API key.

## Timeframes

Both workflow types adapt to the research timeframe:

### Short-term
- **Focus**: Recent price movements, technical indicators
- **Data**: Last 30 days, daily intervals
- **Use case**: Trading decisions

### Mid-term
- **Focus**: Quarterly fundamentals, price trends
- **Data**: Last 6 months, daily intervals
- **Use case**: Swing trading

### Long-term
- **Focus**: Annual fundamentals, long-term trends
- **Data**: Last 2 years, weekly intervals
- **Use case**: Investment decisions

## Fundamentals Workflows

Fundamentals workflows focus specifically on fundamental analysis and financial metrics.

### What It Does

1. Retrieves comprehensive fundamental data
2. Analyzes financial statements
3. Calculates key financial ratios
4. Provides fundamental metrics and trends

### When to Use

- ✅ Deep fundamental analysis
- ✅ Financial statement review
- ✅ Ratio analysis
- ✅ No API key required

### Example

```bash
copinance research run AAPL --workflow stock --timeframe long_term
```

## Choosing a Workflow

**Use Static if:**
- You want consistent, comprehensive analysis
- You don't have an API key
- You need fast results

**Use Agentic if:**
- You have specific questions
- You want adaptive analysis
- You have an API key configured

**Use Fundamentals if:**
- You need detailed financial analysis
- You want to focus on financial statements and ratios
- You don't need AI-powered insights

## Research Lifecycle: Create, Execute, and Run

Copinance OS provides three commands for managing research: `create`, `execute`, and `run`. Each serves a different purpose in the research lifecycle.

### The Three Commands

1. **`create`** - Creates a research task without executing it
   - Prepares research with specific configuration
   - Returns a research ID for later use
   - Useful for batch processing and scheduling

2. **`execute`** - Executes an existing research by ID
   - Can be called multiple times on the same research
   - Allows re-running with different contexts or questions
   - Useful for iterative analysis

3. **`run`** - Creates and executes in one command
   - Convenience method for quick analysis
   - Best for one-off research tasks
   - No need to manage research IDs

### When to Use Each

**Use `create` when:**
- You want to prepare research tasks in advance
- You're setting up multiple research tasks for batch processing
- You need to schedule research for later execution
- You want to configure research before running it

**Use `execute` when:**
- You have an existing research ID from a previous `create` command
- You want to re-run research with updated data
- You need to run the same research with different questions/contexts
- You're doing iterative analysis on the same stock

**Use `run` when:**
- You want quick one-off analysis
- You don't need to save or reuse the research
- You're doing exploratory research
- You're testing workflows

### Example Workflows

**Batch Processing:**
```bash
# Create multiple research tasks
copinance research create AAPL --workflow stock
copinance research create MSFT --workflow stock
copinance research create GOOGL --workflow stock

# Execute them later (or in parallel)
copinance research execute <research-id-1>
copinance research execute <research-id-2>
copinance research execute <research-id-3>
```

**Iterative Analysis:**
```bash
# Create research once
copinance research create AAPL --workflow agent

# Execute with different questions
copinance research execute <research-id> --question "What are the key risks?"
copinance research execute <research-id> --question "What is the growth outlook?"
```

**Quick Analysis:**
```bash
# One command for quick results
copinance research run AAPL --workflow stock

## Macro Regime Workflow

The macro regime workflow combines market regime indicators with macroeconomic data to provide a comprehensive view of market conditions. Use the dedicated CLI command for easy access.

### Quick Start

```bash
# Full analysis with defaults
copinance research macro
```

### Customization

**Market Index:**
Choose which market index to analyze:
```bash
copinance research macro --market-index SPY    # S&P 500 (default)
copinance research macro --market-index QQQ    # Nasdaq 100
copinance research macro --market-index DIA     # Dow Jones
copinance research macro --market-index IWM    # Russell 2000
```

**Lookback Period:**
Adjust the analysis window:
```bash
copinance research macro --lookback-days 90    # 3 months
copinance research macro --lookback-days 252    # 1 year (default)
copinance research macro --lookback-days 504   # 2 years
```

**Indicator Selection:**
Enable or disable specific indicators:

```bash
# Only macro indicators (rates, credit, commodities, labor, housing, manufacturing, consumer, global, advanced)
copinance research macro \
  --no-include-vix \
  --no-include-market-breadth \
  --no-include-sector-rotation

# Advanced economic analysis (include all categories)
copinance research macro \
  --include-labor \
  --include-housing \
  --include-manufacturing \
  --include-consumer \
  --include-global \
  --include-advanced

# Only market regime indicators
copinance research macro \
  --no-include-rates \
  --no-include-credit \
  --no-include-commodities
```

### What It Analyzes

**Market Regime Indicators:**
- **VIX**: Volatility index measuring market fear
- **Market Breadth**: Advancing vs declining stocks
- **Sector Rotation**: Which sectors are leading/lagging

**Macro Indicators:**
- **Rates**: 10Y Treasury yields, yield curve analysis
- **Credit**: Credit spreads (HYG, LQD)
- **Commodities**: Energy prices (oil, natural gas)

**Data Sources:**
- Macro indicators prefer FRED API (if `COPINANCEOS_FRED_API_KEY` configured) for true yields/spreads
- Falls back to yfinance proxies if FRED unavailable
- Market regime indicators use yfinance

### Use Cases

- **Market Regime Detection**: Identify bull/bear markets, volatility regimes
- **Macro Environment**: Understand interest rate environment, credit conditions
- **Sector Analysis**: See which sectors are rotating in/out of favor
- **Risk Assessment**: Combine volatility (VIX) with credit spreads for risk-on/risk-off signals

### Examples

```bash
# Quick market check
copinance research macro --lookback-days 90

# Deep dive on Nasdaq
copinance research macro --market-index QQQ --lookback-days 504

# Focus on macro conditions
copinance research macro \
  --no-include-vix \
  --no-include-market-breadth \
  --no-include-sector-rotation
```

## Next Steps

- [CLI Reference](cli) - Command details
- [Configuration](configuration) - Setting up API keys

